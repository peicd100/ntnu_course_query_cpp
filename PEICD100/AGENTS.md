# AGENTS.md（精簡版：僅保留握手規則＋環境/系統使用硬規則＋README.md 格式規範）
# 適用：Codex、GitHub Copilot、Gemini Code Assist、以及任何具備「讀寫 workspace 檔案」能力的 Agent
# 適用語言：任何程式語言（Python、C++ 等）

# AGENTS.md 位置規則（硬性）
# - 本專案唯一權威 AGENTS.md 固定在：PEICD100\AGENTS.md
# - 任何「重新閱讀/確認規則/開始新任務」都必須回到 PEICD100\AGENTS.md 重新完整讀取
# - 若 workspace 內存在其他同名 AGENTS.md，只能視為一般文件，不得取代本檔規則

================================================================================
0. 讀取優先（硬性；必須最先完成）
================================================================================

0.1 在做任何事情之前，你必須先「從頭到尾完整讀完」本 AGENTS.md（PEICD100\AGENTS.md）。
- 不得讀到一半就開始任何動作（包含詢問、執行命令、修改檔案）。
- 不得依賴先前記憶或上次讀取結果；本次任務必須重新完整讀取一次。
- 若你被要求重新閱讀：你必須回到 PEICD100\AGENTS.md 重新讀取。

0.2 若你無法完整讀取本文件（權限/沙箱/截斷/讀取失敗等）：
- 你必須立刻停止
- 在對話回覆說明原因與影響
- 不得自作主張開始任何行動

================================================================================
1. 全域硬規則（環境／系統使用；所有情境都必須遵守）
================================================================================

1.1 語言
- 對話回覆一律使用繁體中文（程式碼/命令/路徑可用英文）。
- 禁止使用任何 emoji、顏文字或表情符號。

1.2 行動前置（握手）
- 在你完成「啟動握手」之前：
  - 不得執行任何命令（含 python/conda/pip/pyinstaller/git）
  - 不得修改任何檔案
  - 不得進行任何會改變 workspace 狀態的動作

1.3 封閉範圍
- 你的任何檔案操作必須限制在 workspace root（VS Code 開啟的資料夾根目錄）內。
- 禁止修改 workspace root 以外的任何檔案或設定。

1.4 禁止改系統設定 / 全域設定
- 嚴禁任何系統或全域設定修改（PATH、永久環境變數、ExecutionPolicy、登錄檔、需要管理員權限的設定、全域安裝程式）。
- 只能使用 Anaconda/Conda 管理環境。

1.5 禁止無效重試
- 禁止在受限環境中反覆重試同一件必然失敗的事。
- 一旦確認受限，必須立刻停止重試並清楚回報限制與替代方案。

1.6 違規拒絕
- 若使用者要求違反任何硬規則，你必須拒絕並指出違反哪一條（章節編號），並提出合規替代方案（若存在）。

1.7 Git 指令禁令（硬性）
- 在任何情境下，你禁止在終端機執行任何 git 指令（包含 git init/add/commit/push/fetch/pull/reset/clean/status 等）。
- 版本控制與 GitHub 操作一律由使用者自行處理。
- 你必須維護 README.md 中的 GitHub操作指令章節作為文件（但不得在終端機執行）。

1.8 刪除行為禁令（硬性）
- 你不得刪除任何檔案或資料夾。
- 若使用者要求刪除：你只能輸出「可刪清單（含理由/風險）」與「由使用者執行」的逐項刪除指令；你不得自行執行刪除命令。

================================================================================
2. 啟動握手（必做；硬性；握手完成即可開始）
================================================================================

在開始任何動作之前，你必須先在對話回覆中輸出以下內容。
握手輸出完成後，即可開始後續作業（不需要模式選擇），但仍必須遵守第 3 章的重要變數索取規則。

1) 我已在本次任務中重新完整讀取並正在遵守 PEICD100\AGENTS.md：是 / 否
2) 我實際讀取到的 PEICD100\AGENTS.md 路徑：<絕對路徑或可定位路徑>
3) 我判定的 workspace root（VS Code 開啟的資料夾根目錄）：<絕對路徑>

若你無法判定 workspace root 絕對路徑（硬性）：
- 你必須在握手第 3 項明確輸出：無法判定
- 並在同一次回覆向使用者索取：workspace root 絕對路徑（VS Code 開啟的資料夾根目錄）

================================================================================
3. 重要變數索取規則（硬性；不得猜測）
================================================================================

3.1 必須索取的變數
- ENV_NAME
- EXE_NAME

3.2 索取時機（符合其一即必須先索取）
- 使用者要求你撰寫／生成／重寫 README.md（或要求你補齊 README.md 的章節骨架）
- 使用者要求任何與 conda 環境有關的操作（建立/刪除/安裝/執行/測試/打包/產生鎖定檔等）
- 任何你需要在文件中落地「環境名稱」或「可執行檔名稱」時

3.3 不得猜測（硬性）
- 若 ENV_NAME 或 EXE_NAME 任何一個缺失或不明確：你必須停止，並向使用者索取。
- 禁止用推測、既有習慣、或從其他地方猜測 ENV_NAME/EXE_NAME。

3.4 基本格式約束（硬性）
- ENV_NAME：英文小寫 + 底線（例如：ntnu_course_query_cpp），且作為 conda 環境命名依據。
- EXE_NAME：必須等於 workspace root 資料夾名稱（basename）。
  - 若可取得 workspace root 絕對路徑：EXE_NAME 取其 basename。
  - 若無法取得或無法確認 basename：必須向使用者索取 EXE_NAME 或請使用者提供路徑證據。

3.5 conda 環境安全範圍（硬性）
- 只允許建立/刪除/修改「ENV_NAME 對應」的 conda 環境。
- 嚴禁改動任何非 ENV_NAME 的 conda 環境（包含 install/remove 套件、環境刪除、環境更新等）。

================================================================================
4. README.md 格式規範（硬性；作為唯一完整使用說明來源）
================================================================================

4.1 README.md 位置（硬性）
- README.md 必須在 workspace root：workspace root/README.md

4.2 README.md 的 H1（硬性）
- 第一行必須為：# <workspace_root_basename>

4.3 README.md 必填章節（硬性；可擴充但不可刪）
(1) 專案概述
(2) 重要變數（必填）
    - ENV_NAME：<英文小寫+底線；同時作為 GitHub repositories 命名依據>
    - EXE_NAME：<workspace root 資料夾名稱（basename）>
(3) workspace root 定義
(4) 檔案與資料夾結構（樹狀；最小必要集合）
    - 必須輸出「帶線條」的檔案樹（硬性）：需使用可視線條字元呈現階層，例如 `├─`、`│`、`└─`（或同等的 ASCII/Unicode tree 形式）。
    - 檔案樹必須以 code fence 輸出（硬性）。
    - 檔案樹下方必須明確標示（硬性）：
      - 專案輸入檔案存放位置
      - 專案輸出檔案存放位置
    - 上述輸入/輸出位置的描述必須與 (6) user_data/ 規範一致（硬性）。
(5) Python 檔名規則（app_main.py + app_*.py 同層）
(6) user_data/ 規範（所有輸入/輸出/設定預設放在 user_data/；若使用者另有指定，以(11)為準）
(7) Conda 環境（ENV_NAME）規範
(8) 從零開始安裝流程（可一鍵複製；註解不得同列命令）
    - 從 conda create 到執行程式的所有指令
(9) 測試方式
(10) 打包成 .exe（必填；提供可複製指令）
    - 需要提供無安裝環境，點下 .exe 依然能執行的打包方式
    - 打包指令必須包含 `-y`（硬性），用於非互動覆寫確認。
(11) 使用者要求（必填；長期約束；需持續維護）
(12) GitHub操作指令（必填；必須置於 README.md 最後面；凍結區塊）

4.4 README.md 修改方式限制（硬性；避免破壞）
- 禁止整份重寫 README.md；只允許局部更新相關章節
- (12) GitHub操作指令為凍結區塊：不得格式化/重排/改空白；只允許替換 URL 的 ENV_NAME 佔位符（見 4.5）

4.5 README.md 的 GitHub操作指令（凍結區塊；硬性）
- 本段落必須置於 README.md 最後面，且內容必須完全一致。

輸出縮排規則（硬性；AGENTS.md 與 README.md 可能不同）：
- 本 AGENTS.md 內的凍結區塊正文允許為了閱讀性而「整體縮排」（例如每行前置 4 個空白）。
- 但在輸出到 README.md 時，你必須將凍結區塊正文「取消整體縮排」，以頂格（不縮排）形式輸出在 README.md（硬性）。
- 取消縮排僅限於「整體外層縮排」：也就是移除每行相同數量的前置空白；除此之外的任何空白差異一律視為違規（硬性）。
- README.md 中凍結區塊內每個 code block 的 code fence 與其內文命令行必須具有相同縮排（硬性）；依本規則，應為頂格（0 縮排）。

「完全一致」定義（硬性）：
- 以「README.md 中的頂格版本」作為比較基準。
- 除了下列「唯一允許變更」之外，其餘每一字每一行都不得變更（含空白、大小寫、引號、code fence、指令內容、順序）。
- 唯一允許變更（硬性）：
  - 僅允許將下方凍結區塊內所有 GitHub URL 行中的 `https://github.com/peicd100/ENV_NAME.git` 之 `ENV_NAME` 字樣，
    替換為 README.md (2) 的 ENV_NAME 實際值。
  - 上述允許替換包含但不限於：`git remote add origin ...`、`git clone ...`
  - 只限替換 URL 中的 `ENV_NAME` 佔位符；其餘字元不得變更。
- 除此之外不得更動任何內容（包含任何 git 指令行、echo 行、commit message、push 參數等）。

以下內容即為凍結區塊正文（AGENTS.md 內可為閱讀性縮排；輸出到 README.md 時必須取消縮排並頂格輸出；除了 URL 的 ENV_NAME 佔位符外，任何變更均禁止）：

    # 初始化
    ```
    (
    echo.
    echo # ignore build outputs
    echo dist/
    echo build/
    )>> .gitignore
    git init
    git branch -M main
    git remote add origin https://github.com/peicd100/ENV_NAME.git
    git add .
    git commit -m "PEICD100"
    git push -u origin main
    ```

    # 例行上傳
    ```
    git add .
    git commit -m "PEICD100"
    git push -u origin main
    ```

    # 還原成Git Hub最新資料
    ```
    git rebase --abort || echo "No rebase in progress" && git fetch origin && git switch main && git reset --hard origin/main && git clean -fd && git status
    ```

    # 查看儲存庫
    ```
    git remote -v
    ```

    # 克隆儲存庫
    ```
    git clone https://github.com/peicd100/ENV_NAME.git
    ```

4.6 README.md 維護義務（硬性）
- 只要發生下列任一情境，就必須同步更新 README.md 的對應章節：
  - 新增/修改程式碼或入口點
  - 變更安裝/執行方式（含 conda 套件、命令、參數）
  - 變更輸入/輸出/設定檔位置或規範

4.7 B. Conda 環境安裝規範（硬性；README.md 必須套用）
----------------------------------

衝突裁決（硬性）：
- 本節為 conda/pip 安裝與環境流程規範，README.md 內容必須套用本節。
- 若本節與本文件既有規則（例如第 1～3 章、4.1～4.6、或第 5 章）有任何衝突，以本文件既有規則為準。

我使用 Anaconda/Conda 管理環境（Python、C++ 等），請遵守：

### B-0 變數索取規則（全域硬性）

1. 只要在任何模式/任何情境下，你的回覆需要用到下列任一值：

- ENV_NAME（Conda 環境名稱；亦作為 GitHub repository 命名依據）
- EXE_NAME（= workspace root 的 basename；亦作為 .exe 命名依據）

2. 你必須向使用者索取該值，且不可自行決定、不可自行推定、不可用預設值代替（除非使用者明確授權你可自行指定）。

附註（硬性）：
- workspace root（絕對路徑）與 EXE_NAME（basename）為不同概念，不得混用。
- 若你需要引用路徑，應稱為 workspace root（絕對路徑）；若你需要引用可執行檔名稱，應稱為 EXE_NAME（basename）。

#### B-0-1 變數缺失即阻擋輸出（最高優先級；硬性）

適用範圍（硬性）：
- 本小節僅適用於你將輸出「可執行交付內容」時（例如安裝指令、README 章節內容、打包指令、腳本等）。
- 本小節不適用於第 2 章啟動握手本身。
- 若本回覆不需要使用 ENV_NAME/EXE_NAME，則不得觸發本小節。
- 例外（硬性）：若使用者要求違反本文件任何硬規則，你必須優先依 1.6 回覆（拒絕＋指出條款＋合規替代方案），不受本小節「只能索取變數」限制。

1. 只要你判斷本次回覆需要使用 ENV_NAME 或 EXE_NAME，但使用者尚未提供該值：

- 你必須立刻停止。
- 你的回覆內容只能是索取缺失變數本身，除此之外不得輸出任何其他內容。
- 禁止：不得先給部分指令/部分步驟/部分程式碼、不得先給任何建議或解釋、不得先做上網搜尋結果整理、不得用佔位符代替、不得承諾之後再補。

2. 你只能索取本次確實需要的變數：

- 若只需要 ENV_NAME：只能索取 ENV_NAME。
- 若只需要 EXE_NAME：只能索取 EXE_NAME。
- 若兩者都需要：只能索取 ENV_NAME 與 EXE_NAME。

3. 使用者提供變數後，你才可以在下一次回覆輸出完整內容（安裝指令/README/打包指令/腳本等），並必須一次輸出完成。

4. 標準索取格式（硬性；回覆只能包含下列一行或兩行，視需要而定）：

- 請提供 ENV_NAME（英文小寫+底線）。
- 請提供 EXE_NAME（需等於 workspace root 的資料夾名稱 basename）。

### B-1 指令優先順序（硬性）

1. 你提供的安裝與操作指令優先使用 conda。
2. 安裝套件時優先 conda install；只有在 conda 無法取得、版本不適用、或相容性因素必須改用 pip 時，才可使用 pip install，並且你必須清楚說明原因。

### B-2 安裝位置與系統變更偏好（硬性）

1. 我傾向把工具與套件安裝在 conda 環境內，避免要求我把工具全域安裝或加入系統 PATH。
2. 原則上禁止全域安裝或修改 PATH（依本文件 1.4）。
   - 若使用者仍堅持且由使用者自行執行，你必須說明：為何、可行替代方案、以及如何回復（撤銷變更）。
   - 你不得代為執行或指示繞過本文件 1.4。

### B-3 從零開始的安裝流程（只要你提供從零開始流程就必須包含；硬性）

1. 建立 conda 環境。
2. 啟用 conda 環境。
3. 所有必要的 conda 安裝指令。
4. 所有必要的 pip 安裝指令（若有，必須附原因）。

### B-4 執行方式與設備參考（供效能取捨參考；硬性）

1. 我精熟 Python；若你判斷以 Python 在我本機執行能帶來更可靠或更高效率的結果，請主動建議我改用本機執行，並直接提供可執行的程式碼（必要時提供 CPU / GPU 版本）。
2. 我的硬體規格（供效能取捨參考）：同第 6 章。
3. 提供程式碼時，你必須一併交代：

- 輸入資料格式/位置
- 輸出內容/位置
- 環境建立與執行指令（包含 conda 指令；若需要 pip 必須附原因）

### B-5 套件來源判定（硬體導向 + 上網核對；強制）

1. 只要我問要裝哪些套件/conda 怎麼裝/pip 怎麼裝/conda 與 pip 哪個好，或你在回覆中需要提出安裝指令：

- 你必須先依據硬體規格（Windows 11 win-64、i9、RTX 4070 12GB、RAM 64GB）判斷是否應提供 GPU 版本或 CPU 版本。

2. 你必須上網搜尋並以官方文件/官方安裝頁優先核對下列事項，再給我指令：

- 該套件在 win-64 是否有 conda 套件（含官方 channel、conda-forge、或專案官方 channel）
- 若需要 GPU：官方支援的 CUDA 版本範圍，以及 Windows 上的安裝方式（conda/pip 對應指令）
- 若 conda 不可行：PyPI 是否有對應 Python 版本與平台（win_amd64）的 wheel；若沒有，是否會變成需編譯（需明示風險與替代方案）

3. 若無法連網：

- 你必須明確說明無法核對最新官方安裝資訊。
- 你必須改用本機可行的替代檢查方式（例如 conda search / pip index versions），再給出最保守可用的指令方案。

### B-6 指令輸出規格（分段版；硬性）

1. 只要我要求安裝指令，或你需要提出安裝方案，你必須一次提供三套方案（除非其中一套明確不可行）：

- A. 推薦方案（conda 優先）
- B. 備援方案（conda + pip；pip 必須附原因）
- C. 最後手段（pip only）

2. 每套方案必須輸出固定命令行並可直接複製執行（硬性）。

輸出格式（硬性）：
- 每套方案必須先輸出「指令說明」（純文字；不得放入 code fence）。
- 指令說明之後，必須以「單一 code fence」輸出該方案所有命令行（硬性）。
- code fence 內不得出現任何註解或說明文字；只能包含命令行（硬性）。
- 目標 shell 預設為 Windows CMD。
- 註解不得同列命令（硬性）：所有註解/說明一律放在 code fence 外。

命令行行數規則如下（硬性）：
- 第 1 行：只做建立環境（conda create）
- 第 2 行：只做啟用環境（必須符合本文件 5.2 的 conda 進入方式；可用單行 `&&` 串接完成）
- 第 3 行：conda 安裝（只允許 conda install；若本方案無需 conda 安裝則省略此行）
- 第 4 行：pip 安裝（只允許 pip install；若本方案無需 pip 安裝則省略此行；且僅在 conda 無法取得/版本不適用/相容性因素必須改用 pip 時才可使用，並必須在 code fence 外清楚說明原因）
- 第 5 行：驗證（必填）+ 若有 GPU 則做最小 GPU 可用性檢查（同一行內）

3. 你必須簡短說明你最後推薦哪一套，以及理由（相容性/安裝成功率/是否利用 RTX 4070）。

### B-7 README.md 套用規則（硬性）

1. 本節 B. Conda 環境安裝規範為 README.md 中 conda/pip 安裝與環境流程規範的唯一依據。
2. 只要你生成/更新 README.md 的 (7)，內容必須完全遵守本節。
3. README.md 不得另行發明新的 conda/pip 規則、不得與本規範牴觸；若需增補，必須先增補在本規範內，再由 README 套用。
4. 若本節與本文件既有規則有任何衝突，以本文件既有規則為準。

================================================================================
5. Conda / 環境安全核心（硬性）
================================================================================

5.1 核心禁令（硬性）
- 嚴禁對 base install/remove（允許 activate base 作為入口）。
- 嚴禁改動任何非本專案 ENV_NAME 的 conda 環境。
- 嚴禁使用非 conda env 的 python 做 pip install。
- 禁止使用其他環境管理工具（venv/poetry/uv/rye/pyenv 等）。

5.2 conda 進入方式（硬性規定）
- cmd + activate.bat：
  call "C:\ProgramData\Anaconda3\Scripts\activate.bat" "C:\ProgramData\Anaconda3"
  conda activate base
  conda activate <ENV_PATH 或 ENV_NAME>

5.3 環境驗證（硬性規定）
- 證據必須來自 python：
  python -c "import sys; print(sys.executable); print(sys.prefix)"
- 必須能從輸出辨識其屬於 ENV_NAME（不可猜）。
- 若無法執行上述驗證命令取得證據（例如終端機不可用/被禁用/受限）：
  - 視為「無法驗證」
  - 你必須停止所有需要環境正確性的行為（安裝/打包/產生鎖定檔/測試等）
  - 並在對話回覆清楚說明限制與影響

5.4 工具鏈一律 Conda 化（硬性；含 C/C++）
- 無論專案語言為何，凡涉及依賴/工具鏈（包含 Python 套件、CMake、Ninja、編譯器等）均必須以 conda 安裝並使用於 ENV_NAME 環境內。
- 禁止改用系統層安裝器、全域安裝、或透過修改 PATH 等方式繞過 conda。
- 若受限於環境導致無法在 conda 內取得必要工具鏈：必須停止並回報限制與替代方案（由使用者自行處理系統層安裝/設定）。

================================================================================
6. 硬體規格（供效能取捨參考）
================================================================================

- Windows 11（win-64）
- CPU：Intel Core i9
- GPU：NVIDIA GeForce RTX 4070（12GB VRAM）
- RAM：64GB
- 僅供效能取捨參考；不得因此要求或進行任何系統/全域設定修改（見 1.4）。

================================================================================
10. 完成宣告（硬性；用於辨識是否已完成）
================================================================================

10.1 允許輸出完成宣告的唯一條件（硬性）
- 僅當你已完成「本次任務中使用者交代的全部事項」，且不存在任何待辦、阻塞、或需使用者補充資訊的項目時，才允許輸出完成宣告。
- 若仍有任何未完成事項、進行中事項、待確認事項、或因規則限制/環境受限而無法完成之事項：
  - 你必須明確回報目前狀態、剩餘待辦、與阻塞原因（若有）
  - 並且不得輸出完成宣告

10.2 完成宣告輸出格式（硬性）
- 完成宣告必須以「單獨一行」輸出，且必須放在當次回覆的最後一行，不得附加其他文字：
# PEICD100您交代的事情已經全數完成
